---
title: "Lab 02 - Глобальные пластиковые отходы"
output: 
  tufte::tufte_html:
    tufte_variant: "envisioned"
    highlight: pygments
    css: ../lab.css
link-citations: yes
---

```{r include = FALSE}
knitr::opts_chunk$set(eval = FALSE)
```

Загрязнение пластиком - это важная и растущая проблема, оказывающая негативное воздействие на океаны и благополучие дикой природы.
[Our World in Data](https://ourworldindata.org/plastic-pollution) содержит множество отличных наборов данных разного уровня, в том числе глобальные, в разрезе стран с разбивкой по времени.
В данной лабораторной мы сосредоточимся на данных за 2010 год.

# Цели обучения

-   Визуализация числовых и категориальных переменных и интерпретация графиков
-   Пере-создание визуализаций
-   Получение практики работы в R, RStudio, Git и GitHub

# Начало работы

Создайте внутри Вашего проекта папку `Lab-02` и положите в нее файл `lab-02.Rmd`, а также папку `data`.

Откройте документ R Markdown `lab-02.Rmd` и соберите его (Knit).
Убедитесь, что он скомпилирован без ошибок.
Результат будет содержаться в файле markdown `.md` с тем же самым именем.

## Пакеты

Мы будем использовать набор пакетов **tidyverse** для выполнения задания.
Выполните в консоли следующий код.

```{r load-packages, message=FALSE, eval=TRUE}
library(tidyverse)
```

## Данные

Набор данных для сегодняшнего задания находится в файле csv в папке `data`.
Его можно загрузить следующим образом.

```{r load-data, message=FALSE, eval=TRUE}
plastic_waste <- read_csv("data/plastic-waste.csv")
```

В наборе данных содержатся следующие переменные:

-   `code`: трехбуквенный код государства
-   `entity`: название государства
-   `continent`: континент
-   `year`: год
-   `gdp_per_cap`: ВВП на душу населения в постоянных ценах 2011 г. в международных долларах
-   `plastic_waste_per_cap`: Количество пластиковых отходов на душу населения в кг / сутки
-   `mismanaged_plastic_waste_per_cap`: Количество неправильно утилизированных пластиковых отходов на душу населения в кг / день
-   `mismanaged_plastic_waste`: Общее количество неправильно утилизированных пластиковых отходов, тонны
-   `coastal_pop`: Количество людей, живущих на побережье / вблизи побережья
-   `total_pop`: Общая численность населения согласно Gapminder

# Разминка

-   Убедитесь, что набор данных загружен и отображается на вкладке Environment. Сколько наблюдений содержится в наборе данных? Кликнув по набору данных на вкладке Environment, вы сможете рассмотреть его подробнее. Либо, вы можете набрать в консоли `View(plastic_waste)`.

# Упражнения

Начнем со взгляда на распределение пластиковых отходов на душу населения в 2010 году.

```{r plastic_waste_per_cap-hist, eval=TRUE}
ggplot(data = plastic_waste, aes(x = plastic_waste_per_cap)) +
  geom_histogram(binwidth = 0.2)
```

Одно государство является очень необычным наблюдением в правом хвосте распределения.
Один из способов идентифицировать это государство - отфильтровать данные по государствам, где количество пластиковых отходов на душу населения превышает 3.5 кг на человека.

```{r plastic_waste_per_cap-max, eval=TRUE}
plastic_waste %>%
  filter(plastic_waste_per_cap > 3.5)
```

Вы ожидали такой результат?
Вы можете немного поискать информацию о Тринидаде и Тобагов в сети, чтобы попытаться понять, почему там настолько высокое количество пластиковых отходов на душу населения, либо это просто ошибка в данных.

1.  Отобразите с помощью гистограммы распределение пластиковых отходов на душу населения на панелях отдельно по континентам. Что можно сказать о том, как соотносятся континенты по количеству пластиковых отходов на душу населения?

```{marginfigure}
**Замечание:** С настоящего момента и далее графики и результаты не отображаются в настоящией инструкции, но вы можете и должны писать код, рассматривать и описывать результаты самостоятельно в соответствующем документе.
```

Другой способ визуализации числовых данных - это графики плотности.

```{r plastic_waste_per_cap-dens}
ggplot(data = plastic_waste, aes(x = plastic_waste_per_cap)) +
  geom_density()
```

Сравните распределение на разных континентах с применением цветных кривых плотности.

```{r plastic_waste_per_cap-dens-color}
ggplot(data = plastic_waste, 
       mapping = aes(x = plastic_waste_per_cap, 
                     color = continent)) +
  geom_density()
```

Итоговый график может быть трудночитаемым, так что давайте добавим еще и заливку.

```{r plastic_waste_per_cap-dens-color-fill}
ggplot(data = plastic_waste, 
       mapping = aes(x = plastic_waste_per_cap, 
                     color = continent, 
                     fill = continent)) +
  geom_density()
```

Накладывающиеся цвета скрывают распределения, отображенные в первую очередь (они оказываются закрыты следующими распределениями).
Можно изменить прозрачность заливки, чтобы решить эту проблему.
Аргумент `alpha` принимает значения от 0 до 1: 0 соответствует полной прозрачности и 1 полной непрозрачности.
Нельзя сразу сказать, какое значение сработает лучше всего, поэтому надо попробовать несколько вариантов.

```{r plastic_waste_per_cap-dens-color-fill-alpha}
ggplot(data = plastic_waste, 
       mapping = aes(x = plastic_waste_per_cap, 
                     color = continent, 
                     fill = continent)) +
  geom_density(alpha = 0.7)
```

Кажется, пока не очень хорошо...

1.  Пересоздайте графики плотности с использованием другого (меньшего) уровня прозрачности, который сработает лучше при отображении кривых плотности по всем континентам.

2.  Опишите, почему мы определили цвет `color` и заливку `fill` кривых путем установления соответствия с эстетиками графика, а уровень прозрачности `alpha` - как характеристику геометрического образа (geom).

И еще один способ визуализировать эту закономерность - это параллельные диграммы размаха.

```{r plastic_waste_per_cap-box}
ggplot(data = plastic_waste, 
       mapping = aes(x = continent, 
                     y = plastic_waste_per_cap)) +
  geom_boxplot()
```

1.  Преобразуйте параллельные диаграммы размаха из предыдущего задания в [violin plots](http://ggplot2.tidyverse.org/reference/geom_violin.html). Что отображается на скрипичных графиках, чего нельзя понять по диаграммам размаха? А какие особенности очевидны на диаграммах размаха, но не на скрипичных графиках?

```{marginfigure}
**Напоминание:** Мы используем `geom_point()` для создания диаграммы рассеяния.
```

1.  Визуализируйте зависимость между количеством пластиковых отходов на душу населения и количеством неправильно утилизированных пластиковых отходов на душу населения с помощью диаграммы рассеяния.
    Опишите эту зависимость.

2.  Раскрасьте точки на графике в соответствии с континентами.
    Прослеживается ли какое-нибудь выраженное отличие между континентами в отношении того, как связаны общее количество и количество неправильно утилизированных пластиковых отходов на душу населения?

3.  Визуализируйте зависимость между количеством пластиковых отходов на душу населения и общей численностью населения, а также между количеством пластиковых отходов на душу населения и прибрежным населением.
    Вам нужно будет сделать два отдельных графика.
    Какая пара переменных обладает более выраженной линейной зависимостью?

# Подведение итогов

Мы не ожидаем, что вы выполните все задания за отведенный час времени на эту лабораторную.
В идеале, вы должны добраться до этой стадии.
Если у вас еще осталось время, переходите к оставшимся упражнениям ниже.
Если же времени не осталось, вам следует найти время и выполнить их позже вместе с вашими коллегами.
Если же вы не успеваете выполнить упражнения выше, обратитесь за помощью к инструктору прежде чем вы уйдете.

```{marginfigure}
**Указание:** Ось x - это вычисляемая переменная. Одна страна с количеством отходов на душу населения более 3 кг на душу населения отфильтрована. На графике данные  отображены не только точками, но также сглаженной кривой. Термин сглаженный "smooth" поможет [выбрать необходимый geom](https://ggplot2.tidyverse.org/reference/index.html#section-geoms).
```

1.  Воссоздайте следующий график и дайте его интерпретацию.

```{r echo=FALSE, message=FALSE, eval=TRUE, warning=FALSE}
plastic_waste %>% 
  mutate(coastal_pop_prop = coastal_pop / total_pop) %>%
  filter(plastic_waste_per_cap < 3) %>%
  ggplot(aes(x = coastal_pop_prop, y = plastic_waste_per_cap, color = continent)) + 
    geom_point() +
    geom_smooth(color = "black") +
    scale_color_viridis_d() +
    labs(x = "Доля прибрежного населения (Прибрежное / общее население)", 
         y = "Количество пластиковых отходов на душу населения", 
         color = "Континент",
         title = "Пластиковые отходы vs. доля прибрежного населения",
         subtitle = "по континентам") +
    theme_minimal()
```

🧶 ✅ ⬆️ KСоберите итоговый документ, сделайте коммит (commit) и отправьте (push) изменения на GitHub.
Убедитесь, что вы отразили изменения во всех файлах и панель Git опустела.
Теперь вы можете посмотреть итоговый md документ на GitHub и убедиться, что вы довольны окончательным состоянием вашей работы.
